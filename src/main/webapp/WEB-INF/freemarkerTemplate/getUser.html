<!DOCTYPE html>
<html>
  <head>
    <title>showUsers.html</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    
    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
<script type="text/javascript" src="${request.contextPath}/js/jquery-3.0.0.js"></script>
  </head>
  
  <body>
     <div>
         <form id="form" >
              <label>用户编号：</label>
              <input type="text" id="userid"  name="userid" placeholder="请输入用户编号" /><br><br>
              <label>用户名：</label>
              <input type="text" id="username" name="username" placeholder="请输入用户名" /><br><br>
              <input id="submit"  type="submit" value="提交" />
         </form>	
     </div><br><br>
     <div>
        <table border="1">
           <thead>
            <tr>
              <td>用户编号</td>
              <td>用户名</td>
              <td colspan="2">删改操作</td>
            </tr>
           </thead>
           <tbody id="tbody">
               <#list users as user>
                  <tr>
                    <td>${user.userid}</td>
                    <td>${user.username}</td>
                    <td><a id="deleteUser" href="#">删除</a></td>
                    <td><a href="updateUser?userid=${user.userid}">修改</a></td>
                  </tr>
                </#list>
           </tbody>
        </table>
     </div>
     
     <script>
        $(document).ready(function(){
        var syn = false;
           $("#submit").click(function(){
                event.preventDefault();
                if(syn==false){
                   syn = true;
                   var userid = $("#userid").val();
                   var username = $("#username").val();
                   $.ajax({
                      url:"addUser",
                      type:"post",
                      data:{"userid":userid,"username":username},
                      success:function(data){
                         var userid = data.user.userid;
                         var username = data.user.username;
                         var insertString = "<tr>"
                         +"<td>"+userid+"</td>"
                         +"<td>"+username+"</td>"
                         +"<td><a id='deleteUser' href='#'>删除</a></td>"
                         +"<td><a href='updateUser?userid="+userid+"'>修改</a></td>"
                         +"</tr>";
                         $("#tbody").append(insertString);
                         syn = false;
                      },
                      error:function(XMLHttpRequest,textStatus,errorThrown){
                          console.log(XMLHttpRequest.readyState);
                          console.log(textStatus);
                          console.log(errorThrown);
                          syn = false;                      
                      }
                   })
                }
                else{
                   return false;
                }
           });
           
           $("#tbody").on("click","#deleteUser",function(){
               event.preventDefault();
               var that  = this;
               var userid = $(this).parent().parent().children("td:first-child").text();
               $.ajax({
                  url:"deleteUser",
                  type:"post",
                  data:{"userid":userid},
                  success:function(data){
                     var userid = data.userid;
                     $(that).parent().parent().remove();
                  },
                   error:function(XMLHttpRequest,textStatus,errorThrown){
                          console.log(XMLHttpRequest.readyState);
                          console.log(textStatus);
                          console.log(errorThrown);
                   }
               })
           })
        })
     </script>
  </body>
</html>
     